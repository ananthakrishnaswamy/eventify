// 1️⃣ Database
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//////////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////////

enum VendorType {
  HALL
  CATERER
  PUROHIT
  DECOR
  MUSIC
  PHOTOGRAPHY
  VIDEOGRAPHY
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

//////////////////////////////////////////////////////
// VENDOR
//////////////////////////////////////////////////////

model Vendor {
  id          String      @id @default(uuid())
  name        String
  type        VendorType
  description String?
  basePrice   Int?
  location    String
  createdAt   DateTime    @default(now())

  // One-to-one (only for HALL type)
  hall        Hall?

  menus       Menu[]
  availability VendorAvailability[]

  // Individual vendor bookings
  bookings    Booking[]

  // Event bundle bookings
  eventHallBookings     EventBooking[] @relation("HallBooking")
  eventCatererBookings  EventBooking[] @relation("CatererBooking")
  eventPurohitBookings   EventBooking[] @relation("PurohitBooking")
}

//////////////////////////////////////////////////////
// HALL DETAILS (Only for HALL type)
//////////////////////////////////////////////////////

model Hall {
  id        String   @id @default(uuid())
  vendorId  String   @unique
  capacity  Int
  amenities String[]

  vendor    Vendor   @relation(fields: [vendorId], references: [id])
}

//////////////////////////////////////////////////////
// MENU (Only for Caterers)
//////////////////////////////////////////////////////

model Menu {
  id        String   @id @default(uuid())
  vendorId  String
  name      String
  price     Int
  items     String[]

  vendor    Vendor   @relation(fields: [vendorId], references: [id])
}

//////////////////////////////////////////////////////
// AVAILABILITY (For all vendors)
//////////////////////////////////////////////////////

model VendorAvailability {
  id        String   @id @default(uuid())
  vendorId  String
  date      DateTime
  isBooked  Boolean  @default(false)

  vendor    Vendor   @relation(fields: [vendorId], references: [id])

  @@unique([vendorId, date])
}

//////////////////////////////////////////////////////
// SINGLE VENDOR BOOKING (Your current system)
//////////////////////////////////////////////////////

model Booking {
  id            String        @id @default(uuid())
  vendorId      String
  date          DateTime
  amount        Int
  status        BookingStatus @default(CONFIRMED)
  customerName  String
  customerPhone String
  createdAt     DateTime      @default(now())

  vendor        Vendor        @relation(fields: [vendorId], references: [id])
}

//////////////////////////////////////////////////////
// NEW: EVENT BUNDLE BOOKING
//////////////////////////////////////////////////////

model EventBooking {
  id            String        @id @default(uuid())
  date          DateTime

  hallId        String
  catererId     String?
  purohitId      String?

  totalAmount   Int
  status        BookingStatus @default(CONFIRMED)

  customerName  String
  customerPhone String

  createdAt     DateTime      @default(now())

  hall     Vendor   @relation("HallBooking", fields: [hallId], references: [id])
  caterer  Vendor?  @relation("CatererBooking", fields: [catererId], references: [id])
  purohit   Vendor?  @relation("PurohitBooking", fields: [purohitId], references: [id])
}

